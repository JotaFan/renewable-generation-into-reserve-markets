To evaluate the proposed methodology for dynamic procurement of secondary reserves, a case study was conducted using the Spanish electricity market as a benchmark. The Spanish power system is an ideal candidate for this analysis due to its significant integration of variable renewable energy sources (vRES), particularly wind and solar photovoltaic (PV) power. The case study aims to demonstrate the effectiveness of machine learning techniques in improving forecast accuracy and optimizing secondary reserve allocation.\par
\subsection{Data Sources and Preprocessing}

The case study utilizes publicly available operational and historical data from \gls{REE}, the Spanish \gls{TSO}. The dataset includes the following key variables:
\begin{itemize}
    \item \textbf{vRES Generation}: \gls{DA} and real-time generation data for wind and solar power.
    \item \textbf{System Demand}: \gls{DA} forecasts and real-time measurements of electricity consumption.
    \item \textbf{Reserve Activation}: Historical data on upward and downward reserve activation.
    \item \textbf{Market Prices}: \gls{DA} and balancing market clearing prices.
\end{itemize}

\input{tables/indicators_metadata.tex}


The data spans multiple years to account for seasonal variability and long-term trends in vRES generation and demand. Data preprocessing steps included:
\begin{itemize}
    \item Handling missing values using interpolation methods, with \href{https://scikit-learn.org/stable/modules/generated/sklearn.impute.IterativeImputer.html}{IterativeImputer} \cite{vanBuuren2011}\cite{Buck1960}.
    \item Aligning time-series data to ensure synchronization between forecasts, real-time values, and reserve activations.
\end{itemize}

For training the full dataset from 2014 to 2023, inclusive was used. As for validation it was chosen the years 2019-2022, in direct comparison with validation from \cite{Algarvio2024}

\subsubsection{Training Data}

\input{tables/tabela_dados_treino_medias.tex}

% meter heatmap com as variaveis q queremos ver


\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{plots/correlation_heatmap.png}
    \caption{Attribute correlation}
    \label{fig:Attribute_correlation}
  \end{figure}
%   \unskip
  
  
  

\subsubsection{Validation Data}

% meter resultados metricas
\input{tables/tabela_res_benchmark.tex}

% meter heatmap só da validaçao/real
% \input{tables/tabela_dados_validacao_medias.tex}


\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{plots/correlation_heatmap_benchmark.png}
    \caption{Attribute correlation benchmark}
    \label{fig:Attribute_correlation_benchmark}
  \end{figure}
%   \unskip
  
  


\subsection{Methodology Implementation}

The methodology aplied was a "brute force" choosing of better model, which can lead to better fine tuning results than a more complex architecture as shown in \cite{Liu2022}. With multiple model related variables in study:\par

\input{tables/muaddib_variables.tex}

Where each of the model variables in study where a layer of training, giving the best model within that scope we would go to the next variable with the given best option so far. Going back and forward as to not loose best possible choices.\par


\begin{figure}[H]
	\centering
	\resizebox{\linewidth}{!}{\input{tables/methodoly_training.tex}}
	\caption{Model choice method scheme.}
	\label{fig:method_training}
\end{figure}

For the porpuse of controling and processing this experiment three python packages were created.

\begin{itemize}
    \item \textbf{\href{https://github.com/alquimodelia/alquimodelia}{Alquimodelia}}: A keras based model builder package, to create the necessary models with each different arch and variable.
    \item \textbf{\href{https://github.com/alquimodelia/alquitable}{Alquitable}}: A keras based workshop package, to create custom callbacks, loss functions, data generators.
    \item \textbf{\href{https://github.com/alquimodelia/MuadDib}{MuadDib}}: A machine learning framework that uses alquimodelia to test and choose best models on given conditions automatically.
\end{itemize}

The experiments were done using \href{https://keras.io/}{keras}>=3 with a torch backend on a CPU laptop.

\subsection{Results}

The best results for each architeture can be seen below:

\input{tables/tabela_res_metrics.tex}

Within the validation time, best model results can be summarized by:

% meter tableas dos resutlados com benchmark
% \input{tables/tabela_res_metrics.tex}


O método proposto apresenta uma melhoria total, durante o período de validação, de \textasciitilde47\% na alocação a subir e \textasciitilde42\% na alocação a descer face ao método usado no mercado. As melhorias médias são de \textasciitilde37\% e \textasciitilde29\% respectivamente, o que também é uma melhoria face ao estado da arte \cite{Algarvio2024} com 13\% e 8\%.\par


Where the hourly means differences between benchmark and validation results are:

% meter tableas dos resutlados dos deltas com benchmark
% \input{tables/tabela_res_metrics.tex}

O método proposto liberta em média \textasciitilde33\% dos recursos horários, e baixando a necessidade de activar a reserva terciária em \textasciitilde52\% e \textasciitilde59\%.\par


% meter imagens novas correlacoes
% \input{tables/tabela_res_metrics.tex}

Aqui as correlações maiores são, como seria de esperar, entre a energia usada e a sua alocaçao. Com 48\% na energia a subir e 58\% a descer. E as energias alocadas têm uma correlaçao baixa.\par 


% The proposed dynamic reserve procurement methodology is implemented in three main steps:

% \subsubsection*{Forecasting Reserve Needs}
% Machine learning models are trained to predict the upward and downward reserve requirements based on day-ahead forecasts of vRES generation and system demand. Models such as Long Short-Term Memory (LSTM) networks, Random Forests, and XGBoost are used to capture temporal and nonlinear dependencies in the data. The inputs to the models include historical forecasts, real-time deviations, and weather data.

% \subsubsection*{Dynamic Allocation of Reserves}
% Using the machine learning forecasts, the required reserve capacities are dynamically adjusted for upward and downward reserves. The allocation considers real-time deviations observed in previous periods and adjusts procurement to better match actual system needs.

% \subsubsection*{Performance Evaluation}
% The performance of the dynamic reserve procurement is evaluated using key metrics, including:
% \begin{itemize}
%     \item \textbf{Forecast Error (RMSE and MAE)}: Measures the accuracy of reserve predictions.
%     \item \textbf{Reserve Utilization Rate}: Assesses the alignment between procured and activated reserves.
%     \item \textbf{Cost Efficiency}: Compares the costs of dynamic procurement with traditional static methods.
% \end{itemize}

% \subsection*{Results and Analysis}
% The results of the case study demonstrate significant improvements in reserve allocation efficiency compared to the traditional static methods currently used by the Spanish TSO.

% \subsubsection*{Forecast Accuracy}
% The machine learning models, particularly the LSTM network, outperformed traditional statistical methods such as ARIMA in predicting reserve requirements. The Root Mean Square Error (RMSE) was reduced by 15-20\% for both upward and downward reserve predictions.

% Incorporating weather variables into the models significantly improved the accuracy of vRES generation forecasts, which directly influenced reserve predictions.

% \subsubsection*{Reserve Utilization}
% The dynamic approach led to a higher utilization rate of procured reserves. The proportion of unused reserves was reduced by approximately 10\%, indicating a better alignment between forecasted and actual reserve needs.

% Asymmetrical reserve procurement allowed for flexibility in addressing specific system needs, such as prioritizing downward reserves during periods of high solar generation.

% \subsubsection*{Cost Efficiency}
% The dynamic procurement methodology reduced total reserve procurement costs by 8-12\% compared to static allocation methods. This cost savings was primarily driven by the reduction in over-procurement of reserves.

% The analysis showed that the optimized reserve allocation minimized the activation of expensive balancing reserves in the real-time market, further improving cost efficiency.

% \subsubsection*{Impact of vRES Penetration}
% The benefits of dynamic procurement were more pronounced during periods of high vRES penetration, where forecast uncertainty and variability were greatest. This highlights the importance of adapting reserve allocation methodologies to accommodate the increasing share of renewable generation.
